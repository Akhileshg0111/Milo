<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milo-AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.0/themes/prism-tomorrow.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

:root {
    --primary: #2563eb;
    --primary-dark: #1d4ed8;
    --primary-light: #3b82f6;
    --secondary: #f1f5f9;
    --accent: #0ea5e9;
    --bg-primary: #ffffff;
    --bg-secondary: #fafbff;
    --bg-tertiary: #f8fafc;
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-muted: #94a3b8;
    --border-light: #e2e8f0;
    --border-primary: #cbd5e1;
    --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 8px -2px rgb(37 99 235 / 0.1), 0 2px 4px -2px rgb(37 99 235 / 0.06);
    --shadow-lg: 0 10px 20px -5px rgb(37 99 235 / 0.15), 0 4px 6px -4px rgb(37 99 235 / 0.1);
    --shadow-xl: 0 20px 30px -8px rgb(37 99 235 / 0.2), 0 8px 12px -6px rgb(37 99 235 / 0.1);
    --gradient-primary: linear-gradient(135deg, #2563eb 0%, #3b82f6 50%, #0ea5e9 100%);
    --gradient-accent: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
    --gradient-bg: linear-gradient(135deg, #ffffff 0%, #f8fafc 50%, #f1f5f9 100%);
    --border-radius: 16px;
    --border-radius-sm: 12px;
    --border-radius-lg: 24px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    

    --glass-bg: rgba(255, 255, 255, 0.8);
    --glass-border: rgba(255, 255, 255, 0.2);
    --blur-strength: 20px;
    --neon-glow: 0 0 20px rgba(37, 99, 235, 0.3);
    --floating-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: 
        conic-gradient(from 0deg at 20% 30%, rgba(37, 99, 235, 0.05) 0deg, transparent 60deg),
        conic-gradient(from 180deg at 80% 70%, rgba(14, 165, 233, 0.04) 0deg, transparent 60deg),
        linear-gradient(135deg, #fafbff 0%, #f1f5f9 50%, #e2e8f0 100%);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(ellipse at 10% 20%, rgba(37, 99, 235, 0.08) 0%, transparent 40%),
        radial-gradient(ellipse at 90% 80%, rgba(59, 130, 246, 0.06) 0%, transparent 40%),
        radial-gradient(ellipse at 50% 50%, rgba(14, 165, 233, 0.04) 0%, transparent 50%);
    pointer-events: none;
    z-index: -1;
    animation: backgroundShift 20s ease-in-out infinite;
}

.app-container {
    height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
    backdrop-filter: blur(var(--blur-strength));
}

.header {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    padding: 1.25rem 2rem;
    border-bottom: 1px solid var(--glass-border);
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.05),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
    border-radius: 0 0 var(--border-radius) var(--border-radius);
    margin: 0 1rem;
}

.header-content {
    max-width: 1350px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.app-title {
    font-size: 1.875rem;
    font-weight: 800;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
    letter-spacing: -0.025em;
}

.app-title::before {
    content: "‚ú®";
    font-size: 2rem;
    animation: sparkle 3s ease-in-out infinite;
    filter: drop-shadow(0 0 10px rgba(37, 99, 235, 0.5));
}

.chat-container {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
    max-width: 1300px;
    margin: 0 auto;
    width: 100%;
    scroll-behavior: smooth;
    position: relative;
}

.chat-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 20px;
    background: linear-gradient(to bottom, var(--bg-secondary), transparent);
    pointer-events: none;
    z-index: 10;
}

.message {
    display: flex;
    gap: 1.25rem;
    margin-bottom: 2rem;
    animation: messageFloat 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: left center;
}

.user-message {
    flex-direction: row-reverse;
    transform-origin: right center;
}

.avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.1rem;
    flex-shrink: 0;
    position: relative;
    transition: var(--transition);
}

.avatar::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 50%;
    background: var(--gradient-primary);
    z-index: -1;
    opacity: 0;
    transition: var(--transition);
}

.message:hover .avatar::after {
    opacity: 1;
    animation: pulse-ring 2s infinite;
}

.user-avatar {
    background: var(--gradient-primary);
    color: white;
    box-shadow: var(--floating-shadow);
    border: 3px solid rgba(255, 255, 255, 0.8);
}

.user-avatar::before {
    font-size: 1.2rem;
}

.bot-avatar {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    color: var(--primary);
    border: 2px solid var(--glass-border);
    box-shadow: var(--floating-shadow);
}

.bot-avatar::before {
    font-size: 1.2rem;
}

.message-content {
    max-width: 75%;
    padding: 1.25rem 1.5rem;
    border-radius: var(--border-radius-lg);
    position: relative;
    word-wrap: break-word;
    line-height: 1.6;
    font-size: 0.95rem;
    box-shadow: var(--floating-shadow);
    transition: var(--transition);
    backdrop-filter: blur(var(--blur-strength));
}

.message-content::before {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
    bottom: -8px;
}

.bot-message .message-content {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg) var(--border-radius-lg) var(--border-radius-lg) 8px;
    color: var(--text-primary);
    position: relative;
    overflow: hidden;
}

.bot-message .message-content::before {
    left: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid var(--glass-bg);
    border-top: 8px solid var(--glass-bg);
}

.bot-message .message-content::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(37, 99, 235, 0.3) 50%, 
        transparent 100%);
    animation: shimmer 3s ease-in-out infinite;
}

.user-message .message-content {
    background: var(--gradient-primary);
    color: white;
    border-radius: var(--border-radius-lg) var(--border-radius-lg) 8px var(--border-radius-lg);
    position: relative;
    overflow: hidden;
}

.user-message .message-content::before {
    right: 0;
    border-left: 8px solid var(--primary);
    border-right: 8px solid transparent;
    border-top: 8px solid var(--primary);
}

.user-message .message-content::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.1) 0%, 
        transparent 50%, 
        rgba(255, 255, 255, 0.05) 100%);
    pointer-events: none;
}

.message-content:hover {
    transform: translateY(-2px);
    box-shadow: 
        var(--floating-shadow),
        0 0 20px rgba(37, 99, 235, 0.1);
}

.typing-indicator {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg) var(--border-radius-lg) var(--border-radius-lg) 8px;
    box-shadow: var(--floating-shadow);
    max-width: 75%;
    position: relative;
    overflow: hidden;
}

.typing-indicator::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(37, 99, 235, 0.05) 50%, 
        transparent 100%);
    animation: wave 2s infinite;
}

.typing-dot {
    width: 10px;
    height: 10px;
    background: var(--gradient-primary);
    border-radius: 50%;
    animation: typingBounce 1.4s infinite ease-in-out;
    box-shadow: 0 0 10px rgba(37, 99, 235, 0.3);
}

.typing-dot:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
    animation-delay: 0.4s;
}

.typing-text {
    color: var(--text-secondary);
    font-size: 0.9rem;
    font-weight: 500;
    margin-left: 0.5rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.input-container {
    padding: 1.5rem 2rem 2rem;
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    border-top: 1px solid var(--glass-border);
    position: sticky;
    bottom: 0;
    z-index: 50;
    border-radius: var(--border-radius) var(--border-radius) 0 0;
    margin: 0 1rem;
}

.input-wrapper {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
}

textarea {
    width: 100%;
    min-height: 60px;
    max-height: 200px;
    padding: 1.25rem 5rem 1.25rem 1.75rem;
    border: 2px solid var(--glass-border);
    border-radius: var(--border-radius-lg);
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    color: var(--text-primary);
    font-size: 1rem;
    font-family: inherit;
    font-weight: 400;
    resize: none;
    outline: none;
    transition: var(--transition);
    box-shadow: 
        var(--floating-shadow),
        0 0 0 0 rgba(37, 99, 235, 0);
}

textarea:focus {
    border-color: var(--primary);
    box-shadow: 
        var(--floating-shadow),
        0 0 0 4px rgba(37, 99, 235, 0.1),
        var(--neon-glow);
    transform: translateY(-2px);
}

textarea::placeholder {
    color: var(--text-muted);
    font-weight: 400;
}

.input-actions {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

button {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.75rem;
    border-radius: 50%;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    position: relative;
    overflow: hidden;
}

button::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: var(--gradient-primary);
    opacity: 0;
    transition: var(--transition);
    z-index: -1;
}

button:hover::before {
    opacity: 0.1;
}

button:disabled {
    cursor: not-allowed;
    opacity: 0.5;
}

#send-btn {
    background: var(--gradient-primary);
    color: white;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    box-shadow: var(--floating-shadow);
    font-size: 1.2rem;
    font-weight: 600;
    position: relative;
    overflow: hidden;
}

#send-btn::after {
    font-size: 1.1rem;
    transition: var(--transition);
}

#send-btn:hover:not(:disabled) {
    box-shadow: 
        var(--floating-shadow),
        var(--neon-glow);
    transform: translateY(-2px) scale(1.05);
}

#send-btn:active {
    transform: translateY(0) scale(0.95);
}

#send-btn:disabled {
    background: var(--text-muted);
    color: white;
    box-shadow: none;
}

.attach-btn {
    color: var(--text-muted);
    font-size: 1.2rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    backdrop-filter: blur(var(--blur-strength));
}

.attach-btn::after {
    content: "üìé";
    font-size: 1.1rem;
    transition: var(--transition);
}

.attach-btn:hover {
    color: var(--primary);
    background: var(--glass-bg);
    box-shadow: var(--floating-shadow);
    transform: translateY(-2px);
}

.formatted-response {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-family: inherit;
    font-size: 0.95rem;
    line-height: 1.6;
    font-weight: 400;
}

.code-block {
    background: var(--glass-bg) !important;
    backdrop-filter: blur(var(--blur-strength));
    border-radius: var(--border-radius);
    margin: 1rem 0;
    padding: 1.5rem;
    border: 1px solid var(--glass-border);
    position: relative;
    overflow: auto;
    color: var(--text-primary);
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    box-shadow: var(--floating-shadow);
}

.code-block::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
    border-radius: var(--border-radius) var(--border-radius) 0 0;
}

.code-block code {
    color: var(--text-primary);
    display: block;
}

.code-preview-button {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    color: var(--primary);
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    padding: 0.875rem 1.75rem;
    margin-top: 1rem;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
    position: relative;
    overflow: hidden;
}

.code-preview-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(37, 99, 235, 0.1) 50%, 
        transparent 100%);
    transition: var(--transition);
}

.code-preview-button:hover::before {
    left: 100%;
}

.code-preview-button:hover {
    background: var(--secondary);
    border-color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--floating-shadow);
}

.code-preview {
    display: none;
    margin-top: 1rem;
    background: var(--glass-bg);
    backdrop-filter: blur(var(--blur-strength));
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--floating-shadow);
}

.code-preview.show {
    display: block;
    animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Enhanced Animations */
@keyframes sparkle {
    0%, 100% { 
        transform: rotate(0deg) scale(1); 
        filter: drop-shadow(0 0 10px rgba(37, 99, 235, 0.5));
    }
    25% { 
        transform: rotate(-5deg) scale(1.1); 
        filter: drop-shadow(0 0 15px rgba(37, 99, 235, 0.7));
    }
    75% { 
        transform: rotate(5deg) scale(1.1); 
        filter: drop-shadow(0 0 15px rgba(37, 99, 235, 0.7));
    }
}

@keyframes backgroundShift {
    0%, 100% { 
        opacity: 1; 
    }
    50% { 
        opacity: 0.8; 
        transform: scale(1.02);
    }
}

@keyframes messageFloat {
    from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

@keyframes typingBounce {
    0%, 60%, 100% {
        transform: translateY(0) scale(1);
        opacity: 0.7;
    }
    30% {
        transform: translateY(-12px) scale(1.1);
        opacity: 1;
    }
}

@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

@keyframes wave {
    0% {
        left: -100%;
    }
    100% {
        left: 100%;
    }
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .header {
        padding: 1rem 1.5rem;
        margin: 0 0.5rem;
    }
    
    .header-content {
        justify-content: center;
    }
    
    .chat-container {
        padding: 1rem;
    }
    
    .input-container {
        padding: 1rem 1.5rem 1.5rem;
        margin: 0 0.5rem;
    }
    
    .message-content {
        max-width: 85%;
        padding: 1rem 1.25rem;
    }
    
    .app-title {
        font-size: 1.5rem;
    }
    
    .app-title::before {
        font-size: 1.5rem;
    }
    
    textarea {
        font-size: 16px;
        padding: 1rem 4.5rem 1rem 1.5rem;
        min-height: 52px;
    }
    
    .avatar {
        width: 42px;
        height: 42px;
    }
    
    #send-btn {
        width: 40px;
        height: 40px;
    }
    
    .attach-btn {
        width: 36px;
        height: 36px;
    }
}

@media (max-width: 480px) {
    .header {
        padding: 0.75rem 1rem;
        margin: 0 0.25rem;
    }
    
    .chat-container {
        padding: 0.75rem;
    }
    
    .input-container {
        padding: 0.75rem 1rem 1.25rem;
        margin: 0 0.25rem;
    }
    
    .message {
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .message-content {
        max-width: 88%;
        padding: 0.875rem 1.125rem;
        font-size: 0.9rem;
    }
    
    .app-title {
        font-size: 1.25rem;
        gap: 0.75rem;
    }
    
    .app-title::before {
        font-size: 1.25rem;
    }
    
    textarea {
        padding: 0.875rem 4rem 0.875rem 1.25rem;
        font-size: 16px;
        min-height: 48px;
    }
    
    .avatar {
        width: 38px;
        height: 38px;
    }
    
    #send-btn {
        width: 36px;
        height: 36px;
    }
    
    .attach-btn {
        width: 32px;
        height: 32px;
    }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: var(--glass-bg);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--gradient-primary);
    border-radius: 4px;
    border: 2px solid var(--glass-bg);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--gradient-accent);
    box-shadow: var(--neon-glow);
}

/* Focus States */
button:focus-visible,
textarea:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* Smooth Scrolling */
html {
    scroll-behavior: smooth;
}

/* Touch Optimizations */
* {
    -webkit-tap-highlight-color: transparent;
}



    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="app-title">
                    <i class="fas fa-brain">Milo</i>
                </div>
            </div>
        </header>
        
        <div class="chat-container" id="chat-box"></div>
        
        <div class="input-container">
            <div class="input-wrapper">
                <textarea 
                    id="user-input" 
                    placeholder="Ask me anything..."
                    rows="1"
                ></textarea>
                <div class="input-actions">
                    <button id="send-btn" type="button" title="Send message">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.0/prism.min.js"></script>
  <script>
const CONFIG = {
    TYPING_SPEED: 20,
    MIN_RESPONSE_TIME: 800,
    MAX_RESPONSE_TIME: 2000,
    CHUNK_SIZE: 5,
    TOKEN_RATIO: 3,
    DEBOUNCE_DELAY: 150,
    API_URL: 'https://generativelanguage.googleapis.com/v1/models/gemini-2.0-flash-lite:generateContent',
    API_KEY: '',//add ur api key here 
    CACHE_SIZE: 50,
    SUPPORTED_LANGUAGES: {
        'en': 'English',
        'hi': 'Hindi',
        'es': 'Spanish',
        'fr': 'French',
        'de': 'German',
        'it': 'Italian',
        'pt': 'Portuguese',
        'ru': 'Russian',
        'zh': 'Chinese',
        'ja': 'Japanese',
        'ko': 'Korean',
        'ar': 'Arabic',
        'bn': 'Bengali',
        'ta': 'Tamil',
        'te': 'Telugu',
        'mr': 'Marathi',
        'gu': 'Gujarati',
        'kn': 'Kannada',
        'ml': 'Malayalam',
        'pa': 'Punjabi',
        'ur': 'Urdu'
    },
    TEACHER_PROMPT: `You are "Milo" - an AI assistant specifically designed to help teachers and educators. You are owned by "Huddle Fusion". 

CRITICAL RESPONSE RULES:
- if asked for something ask them questions to get to know more
- if asked for worksheet give the actaul worksheet not the code or give in text format
- Provide direct, immediate answers without introductory phrases
- Do not start responses with "Okay", "Here's", "I'll help you", "Let me", or similar conversational starters
- Do not end responses with "Let me know if you need help" or similar closing phrases 
- Be concise and straight to the point
- if asked for programming language questions like asking for the code provide the code
- Start directly with the requested content or information
- Avoid explanatory preambles unless specifically asked for context
- and when it comes to generating html,css,js code i want document level code and provide only code no explanation, working etc just the code


PRIMARY FUNCTIONS:
- Assist teachers with lesson planning, curriculum development, and educational content creation
- Provide multi-language support for translating educational content
- Help with assessment creation, grading rubrics, and student evaluation
- Offer classroom management strategies and teaching methodologies
- Support curriculum alignment and educational standards
- Provide language conversion and translation services for educational materials
- Help with creating multilingual educational resources
- Assist with parent-teacher communication in multiple languages
- Support inclusive education and diverse learning needs
- Provide worksheet without any answer key and clean and clear

LANGUAGE SUPPORT:
- You can translate text between multiple languages including English, Hindi, Spanish, French, German, Italian, Portuguese, Russian, Chinese, Japanese, Korean, Arabic, Bengali, Tamil, Telugu, Marathi, Gujarati, Kannada, Malayalam, Punjabi, and Urdu
- When asked to translate, provide accurate translations with cultural context when needed
- Offer pronunciation guides for non-native speakers when requested
- Help create multilingual educational materials and resources

TEACHING SUPPORT:
- Focus on pedagogical best practices and evidence-based teaching methods
- Provide age-appropriate content suggestions
- Help with differentiated instruction strategies
- Support special needs education approaches
- Assist with technology integration in teaching
- Offer professional development insights

COMMUNICATION STYLE:
- Use direct, professional language without conversational fillers
- Provide practical, actionable content immediately
- Include examples and step-by-step guidance when appropriate
- Be culturally sensitive and inclusive
- Adapt responses to different educational levels and contexts
- Remember previous conversations and build upon them for follow-up questions

IMPORTANT: Always maintain context from previous messages in our conversation. If a user asks a follow-up question, refer back to what we discussed earlier and build upon that context.

RESPONSE FORMAT:
- Start immediately with the requested content
- No greeting phrases or acknowledgments
- No closing pleasantries unless specifically requested
- Focus on delivering the exact information or material requested

If asked about non-educational topics, politely redirect to educational content while offering to help with teaching-related aspects of the query.`
};

const state = {
    chatHistory: [],
    conversationHistory: [], 
    isTyping: false,
    messageCache: new Map(),
    abortController: null,
    startTime: null,
    initialized: false,
    currentLanguage: 'en',
    contextMemory: [] 
};

let chatBox, userInput, sendBtn, languageSelect;

function initializeElements() {
    chatBox = document.getElementById('chat-box');
    userInput = document.getElementById('user-input');
    sendBtn = document.getElementById('send-btn');
    languageSelect = document.getElementById('language-select');
    
    if (!chatBox || !userInput || !sendBtn) {
        console.error('Required elements not found');
        return false;
    }
    
    return true;
}

function escapeHtml(html) {
    const div = document.createElement('div');
    div.textContent = html;
    return div.innerHTML;
}

function createTypingIndicator() {
    const messages = [
        "Preparing cultural context...",
        "Building comprehensive resources...",
        "Enhancing teaching effectiveness..."
    ];
    
    const randomMessage = messages[Math.floor(Math.random() * messages.length)];
    
    return `
        <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-text">${randomMessage}</div>
        </div>
    `;
}

const css = `
.typing-indicator {
    display: flex;
    gap: 0.5rem;
    padding: 1rem;
    align-items: center;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 20px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px var(--shadow-light);
}

.typing-dot {
    width: 10px;
    height: 10px;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    border-radius: 50%;
    animation: typingDot 1.4s infinite ease-in-out;
}

.typing-dot:nth-child(2) { 
    animation-delay: 0.2s; 
}

.typing-dot:nth-child(3) { 
    animation-delay: 0.4s; 
}

.typing-text {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
    opacity: 0;
    animation: fadeInText 2s ease-in-out infinite;
}

.language-selector {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.language-selector select {
    padding: 0.5rem;
    border: 1px solid var(--border);
    border-radius: 5px;
    background: white;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.translation-box {
    background: rgba(240, 248, 255, 0.9);
    border: 1px solid #e1f5fe;
    border-radius: 10px;
    padding: 1rem;
    margin: 0.5rem 0;
}

.translation-header {
    font-weight: bold;
    color: #1565c0;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.teaching-tip {
    background: rgba(255, 248, 225, 0.9);
    border: 1px solid #fff3cd;
    border-radius: 10px;
    padding: 1rem;
    margin: 0.5rem 0;
    border-left: 4px solid #ffc107;
}

.teaching-tip-header {
    font-weight: bold;
    color: #856404;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.teacher-badge {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.context-indicator {
    background: rgba(52, 152, 219, 0.1);
    border: 1px solid rgba(52, 152, 219, 0.3);
    border-radius: 8px;
    padding: 0.5rem;
    margin: 0.5rem 0;
    font-size: 0.85rem;
    color: #2980b9;
}

@keyframes typingDot {
    0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
    }
    40% {
        transform: scale(1.2);
        opacity: 1;
    }
}

@keyframes fadeInText {
    0%, 100% {
        opacity: 0.6;
    }
    50% {
        opacity: 1;
    }
}
`;

function injectCSS() {
    const style = document.createElement('style');
    style.textContent = css;
    document.head.appendChild(style);
}

function calculateResponseTime() {
    return state.startTime ? (Date.now() - state.startTime) / 1000 : 0;
}

function isTeachingQuery(query) {
    const teachingKeywords = [
        'lesson', 'curriculum', 'teach', 'student', 'class', 'classroom', 'education',
        'learning', 'assessment', 'grade', 'exam', 'homework', 'assignment', 'pedagogy',
        'instruction', 'methodology', 'activity', 'resource', 'material', 'plan',
        'objective', 'standard', 'rubric', 'evaluation', 'feedback', 'management',
        'discipline', 'behavior', 'parent', 'communication', 'inclusive', 'differentiated',
        'special needs', 'multilingual', 'translation', 'language', 'culture'
    ];
    
    const queryLower = query.toLowerCase();
    return teachingKeywords.some(keyword => queryLower.includes(keyword)) ||
           queryLower.includes('how to teach') || queryLower.includes('classroom') || 
           queryLower.includes('student') || queryLower.includes('translate') ||
           queryLower.includes('language');
}

function isTranslationQuery(query) {
    const translationKeywords = [
        'translate', 'translation', 'convert', 'language', 'hindi', 'spanish',
        'french', 'german', 'chinese', 'japanese', 'arabic', 'bengali', 'tamil',
        'telugu', 'marathi', 'gujarati', 'kannada', 'malayalam', 'punjabi', 'urdu'
    ];
    
    const queryLower = query.toLowerCase();
    return translationKeywords.some(keyword => queryLower.includes(keyword)) ||
           queryLower.includes('in hindi') || queryLower.includes('in spanish') ||
           queryLower.includes('to english') || queryLower.includes('meaning in');
}

function isFollowUpQuery(query) {
    const followUpKeywords = [
        'what about', 'also', 'additionally', 'furthermore', 'moreover', 'continue',
        'expand', 'elaborate', 'explain more', 'tell me more', 'what else',
        'another', 'other', 'similar', 'related', 'same', 'that', 'this',
        'previous', 'earlier', 'above', 'mentioned', 'discussed', 'talked about'
    ];
    
    const queryLower = query.toLowerCase();
    return followUpKeywords.some(keyword => queryLower.includes(keyword)) ||
           query.length < 50;
}

function buildContextualPrompt(userQuery) {
    let contextualPrompt = CONFIG.TEACHER_PROMPT;
    

    if (isFollowUpQuery(userQuery) && state.contextMemory.length > 0) {
        contextualPrompt += "\n\nRECENT CONVERSATION CONTEXT:\n";
        

        const recentContext = state.contextMemory.slice(-6); 
        recentContext.forEach((item, index) => {
            contextualPrompt += `${item.role === 'user' ? 'Teacher' : 'Assistant'}: ${item.text}\n`;
        });
        
        contextualPrompt += "\nPlease respond to the current question while keeping this conversation context in mind.";
    }
    
    return contextualPrompt;
}

function formatCodeResponse(text) {

    text = text.replace(/\\\((.*?)\\\)/g, '<span class="math-inline">$1</span>');
    text = text.replace(/\\\[(.*?)\\\]/g, '<div class="math-block">$1</div>');
    
    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
               .replace(/\*(.*?)\*/g, '<em>$1</em>');

    const segments = text.split(/(```[\s\S]*?```)/g);
    
    return segments.map(segment => {
        if (segment.startsWith('```') && segment.endsWith('```')) {
            try {
                const codeText = segment.slice(3, -3).trim();
                let language = '';
                let codeContent = codeText;
                
                const firstLineEnd = codeText.indexOf('\n');
                if (firstLineEnd > 0) {
                    const possibleLang = codeText.substring(0, firstLineEnd).trim();
                    if (/^[a-zA-Z0-9#]+$/.test(possibleLang)) {
                        language = possibleLang.toLowerCase();
                        codeContent = codeText.substring(firstLineEnd + 1);
                    }
                }
                
                const escapedCode = escapeHtml(codeContent);
                
                return `
    <div class="teaching-tip">
        <div class="teaching-tip-header">üìù Code Example for Teaching:</div>
        <pre class="code-block language-${language}"><code>${escapedCode}</code></pre>
        <button class="run-code-btn" data-lang="${language}" data-code="${encodeURIComponent(codeContent)}">‚ñ∂Ô∏è Run this code</button>
        <div class="run-output" style="display:none;"></div>
    </div>
`;

            } catch (error) {
                console.error('Error formatting code block:', error);
                return `<pre class="code-block">${escapeHtml(segment.slice(3, -3))}</pre>`;
            }
        }
        
        return `<div class="formatted-response teaching-content">${segment}</div>`;
    }).join('');
}


function injectCSS() {
    const style = document.createElement('style');
    style.textContent = css + `
.math-inline {
    font-family: 'Times New Roman', serif;
    font-style: italic;
    background: rgba(240, 248, 255, 0.8);
    padding: 2px 4px;
    border-radius: 3px;
    border: 1px solid #e1f5fe;
    display: inline-block;
    margin: 0 2px;
}

.math-block {
    font-family: 'Times New Roman', serif;
    font-style: italic;
    background: rgba(240, 248, 255, 0.9);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #e1f5fe;
    margin: 10px 0;
    text-align: center;
    font-size: 1.1em;
}
`;
    document.head.appendChild(style);
}


function renderMathJax() {
    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
        MathJax.typesetPromise().catch(err => console.error('MathJax error:', err));
    }
}


function appendMessage(sender, message, isTyping = false) {
    if (!chatBox) return null;
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}-message`;
    
    const avatar = document.createElement('div');
    avatar.className = `avatar ${sender}-avatar`;
    avatar.textContent = sender === 'user' ? 'üë®‚Äçüè´' : 'ü§ñ';
    
    const content = document.createElement('div');
    content.className = 'message-content';
    
    if (isTyping) {
        content.innerHTML = createTypingIndicator();
    } else if (sender === 'bot') {
        if (isFollowUpQuery(message) && state.contextMemory.length > 2) {
            const contextDiv = document.createElement('div');
            content.appendChild(contextDiv);
        }
        
        const formattedContent = formatCodeResponse(message);
        const responseDiv = document.createElement('div');
        responseDiv.innerHTML = formattedContent;
        content.appendChild(responseDiv);
        
        const responseTime = calculateResponseTime();
        if (responseTime > 0) {
            const metaDiv = document.createElement('div');
            metaDiv.className = 'response-meta';
            metaDiv.innerHTML = `
             <span class="response-time" style="font-size: 10px;">Response time: ${responseTime.toFixed(2)}s</span>
            `;
            content.appendChild(metaDiv);
        }


        setTimeout(() => renderMathJax(), 100);

        content.querySelectorAll('pre code').forEach(block => {
            if (typeof Prism !== 'undefined') {
                Prism.highlightElement(block);
            }
        });
    } else {
        content.textContent = message;
    }
    
    messageDiv.appendChild(avatar);
    messageDiv.appendChild(content);
    
    chatBox.appendChild(messageDiv);
    chatBox.scrollTop = chatBox.scrollHeight;
    
    return messageDiv;
}
async function simulateThinking() {
    const thinkingTime = Math.random() * 
        (CONFIG.MAX_RESPONSE_TIME - CONFIG.MIN_RESPONSE_TIME) + 
        CONFIG.MIN_RESPONSE_TIME;
    return new Promise(resolve => setTimeout(resolve, thinkingTime));
}

async function getMiloResponse(query) {

    const cacheKey = isFollowUpQuery(query) ? null : query.trim();
    if (cacheKey && state.messageCache.has(cacheKey)) {
        return state.messageCache.get(cacheKey);
    }

    state.abortController = new AbortController();

    try {
        await simulateThinking();
        
        const contents = [];
        

        const contextualPrompt = buildContextualPrompt(query);
        

        contents.push({
            role: "user",
            parts: [{ text: contextualPrompt }]
        });
        

        contents.push({
            role: "model",
            parts: [{ text: "I understand. I'm Milo, your AI teaching assistant. I'm ready to help you with educational content, lesson planning, translations, and any teaching-related questions. I'll maintain context from our conversation for follow-up questions." }]
        });
        

        for (const exchange of state.conversationHistory) {
            contents.push({
                role: exchange.role,
                parts: [{ text: exchange.text }]
            });
        }
        

        contents.push({
            role: "user",
            parts: [{ text: query }]
        });
        
        const response = await fetch(`${CONFIG.API_URL}?key=${CONFIG.API_KEY}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                contents: contents,
                generationConfig: {
                    temperature: 0.7,
                    topP: 0.95,
                    topK: 40,
                    maxOutputTokens: 3000
                }
            }),
            signal: state.abortController.signal
        });

        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(`API error: ${response.status} - ${JSON.stringify(errorData)}`);
        }

        const result = await response.json();
        
        let responseText = '';
        if (result.candidates && result.candidates.length > 0 && 
            result.candidates[0].content && 
            result.candidates[0].content.parts && 
            result.candidates[0].content.parts.length > 0) {
            responseText = result.candidates[0].content.parts[0].text.trim();
            

            state.conversationHistory.push({ role: "user", text: query });
            state.conversationHistory.push({ role: "model", text: responseText });
            

            state.contextMemory.push({ role: "user", text: query });
            state.contextMemory.push({ role: "model", text: responseText });
            

            if (state.conversationHistory.length > 20) {
                state.conversationHistory = state.conversationHistory.slice(-20);
            }
            

            if (state.contextMemory.length > 12) {
                state.contextMemory = state.contextMemory.slice(-12);
            }
        } else {
            throw new Error('Unexpected response format from Gemini API');
        }
        

        if (cacheKey) {
            if (state.messageCache.size >= CONFIG.CACHE_SIZE) {
                state.messageCache.delete(state.messageCache.keys().next().value);
            }
            state.messageCache.set(cacheKey, responseText);
        }
        
        return responseText;
    } catch (error) {
        console.error('Error:', error);
        throw error;
    }
}


const handleSendMessage = async () => {
    if (state.isTyping) return;
    
    const query = userInput.value.trim();
    if (!query) return;

    try {
        state.isTyping = true;
        state.startTime = Date.now();
        
        appendMessage('user', query);
        userInput.value = '';
        userInput.style.height = 'auto';
        
        const typingMessage = appendMessage('bot', '', true);
        
        const response = await getMiloResponse(query);
        
        if (typingMessage) {
            typingMessage.remove();
        }
        appendMessage('bot', response);

        setTimeout(() => {
    document.querySelectorAll('.run-code-btn').forEach(button => {
        button.addEventListener('click', async () => {
            const code = decodeURIComponent(button.dataset.code);
            const lang = button.dataset.lang;

            const outputDiv = button.nextElementSibling;
            outputDiv.style.display = 'block';
            
            if (isHTMLCode(code, lang)) {
                outputDiv.innerHTML = 'üåê Opening HTML in new window...';
            } else {
                outputDiv.innerHTML = '‚è≥ Running...';
            }

            try {
                const result = await runCodeWithPiston(code, lang);
                
                if (isHTMLCode(code, lang)) {
                    outputDiv.innerHTML = `<div style="color: #28a745; font-weight: bold;">‚úÖ ${result}</div>`;
                } else {
                    outputDiv.innerHTML = `<pre><strong>Output:</strong>\n${escapeHtml(result)}</pre>`;
                }
            } catch (err) {
                outputDiv.innerHTML = `<pre><strong>Error:</strong> ${escapeHtml(err.message)}</pre>`;
            }
        });
    });
}, 300);

        
        state.chatHistory.push({ 
            message: query, 
            response,
            responseTime: calculateResponseTime()
        });
        
    } catch (error) {
        console.error('Error:', error);
        appendMessage('bot', 'Sorry, I encountered an error while trying to assist you. Please try asking your question again!');
    } finally {
        state.isTyping = false;
        state.startTime = null;
    }
};

function setupEventListeners() {
    if (sendBtn) {
        sendBtn.addEventListener('click', handleSendMessage);
    }

    if (userInput) {
        userInput.addEventListener('keydown', e => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSendMessage();
            }
        });

        userInput.addEventListener('input', () => {
            userInput.style.height = 'auto';
            userInput.style.height = `${userInput.scrollHeight}px`;
        });

        userInput.placeholder = "Ask me about anything!";
    }


    if (languageSelect) {
        Object.entries(CONFIG.SUPPORTED_LANGUAGES).forEach(([code, name]) => {
            const option = document.createElement('option');
            option.value = code;
            option.textContent = name;
            languageSelect.appendChild(option);
        });

        languageSelect.addEventListener('change', (e) => {
            state.currentLanguage = e.target.value;
            console.log('Language changed to:', CONFIG.SUPPORTED_LANGUAGES[e.target.value]);
        });
    }
}

function setupVoiceInput() {
    console.log('Voice input setup called');
}

// Inject CSS dynamically
const style = document.createElement('style');
style.textContent = `
@keyframes wave {
  0% { transform: rotate(0deg); }
  15% { transform: rotate(15deg); }
  30% { transform: rotate(-10deg); }
  45% { transform: rotate(15deg); }
  60% { transform: rotate(-10deg); }
  75% { transform: rotate(15deg); }
  100% { transform: rotate(0deg); }
}

.waving-hand {
  display: inline-block;
  animation: wave 2s infinite;
  transform-origin: 70% 70%;
  font-size: 2rem;
  margin-right: 0.3rem;
  vertical-align: middle;
}
`;
document.head.appendChild(style);

function displayWelcomeMessage() {
    if (chatBox && !state.initialized) {
        const welcomeMessage = `<span class="waving-hand">üëã</span> Hey there! I‚Äôm Milo ‚Äî Your Smart AI Assistant for Teaching & Learning üéì‚ú®
Let‚Äôs make education easier, inclusive, and more fun ‚Äî together!

Here‚Äôs what I can do for you:
üìò Plan engaging lessons & design curriculum
üìù Create quizzes, tests & rubrics in seconds
üåê Translate content across multiple languages
üßë‚Äçüè´ Share tips for classroom management & teaching
‚ôø Support inclusive education for all learners
üì¨ Help with parent-teacher messages & reports

üí¨ Available in üá¨üáß English, üáÆüá≥ Hindi, üá™üá∏ Spanish, üá´üá∑ French, üá©üá™ German, üá∏üá¶ Arabic, and more!

‚ú® Just tell me what you need ‚Äî I‚Äôve got your back!`;

        appendMessage('bot', welcomeMessage);
        state.initialized = true;
    }
}
function restoreChatHistory() {
    if (state.chatHistory.length > 0) {
        state.chatHistory.forEach(item => {
            appendMessage('user', item.message);
            appendMessage('bot', item.response);
            

            state.conversationHistory.push({ role: "user", text: item.message });
            state.conversationHistory.push({ role: "model", text: item.response });
            
            state.contextMemory.push({ role: "user", text: item.message });
            state.contextMemory.push({ role: "model", text: item.response });
        });
        
        if (state.conversationHistory.length > 20) {
            state.conversationHistory = state.conversationHistory.slice(-20);
        }
        if (state.contextMemory.length > 12) {
            state.contextMemory = state.contextMemory.slice(-12);
        }
    }
}

function initialize() {
    if (!initializeElements()) {
        setTimeout(initialize, 100);
        return;
    }
    
    injectCSS();
    setupEventListeners();
    setupVoiceInput();
    restoreChatHistory();
    
    setTimeout(displayWelcomeMessage, 500);
}

window.addEventListener('unload', () => {
    state.messageCache.clear();
    if (state.abortController) {
        state.abortController.abort();
    }
});

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
} else {
    initialize();
}
  </script>
  <script src="js/html.js"></script>
<script src="js/auth-1.js"></script>
  <script src="js/voice-1.js"></script>
  <script src="js/export.js"></script>
  <script src="js/files-1.js"></script>
  <script src="js/copy-btn.js"></script>
<script src="js/nav-1.js"></script>
<script src="js/charts.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>
  
  
  <!-- Google Sign-In -->
  <script src="https://apis.google.com/js/platform.js" async defer></script>
</body>
</html>
