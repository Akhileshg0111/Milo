<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeacherHub - Share Educational Videos</title>
    <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(145deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
    min-height: 100vh;
    color: #1e293b;
    font-size: 14px;
    line-height: 1.5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

/* Header */
header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 10px rgba(59, 130, 246, 0.1);
    position: sticky;
    top: 0;
    z-index: 100;
    border-bottom: 1px solid rgba(59, 130, 246, 0.1);
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    gap: 20px;
}

.logo {
    font-size: 1.8rem;
    font-weight: 800;
    color: #3b82f6;
    display: flex;
    align-items: center;
    gap: 8px;
    letter-spacing: -0.5px;
}

.logo::before {
    content: "üé¨";
    font-size: 1.5rem;
}

.auth-section {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    background: #f8fafc;
    padding: 8px 16px;
    border-radius: 25px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid #3b82f6;
    object-fit: cover;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.4s;
}

.btn:hover::before {
    left: 100%;
}

.btn-primary {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
}

.btn-secondary {
    background: white;
    color: #3b82f6;
    border: 1px solid #3b82f6;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.btn-secondary:hover {
    background: #3b82f6;
    color: white;
    transform: translateY(-1px);
}

/* Main Content */
main {
    padding: 2rem 0 3rem;
}

.welcome-section {
    text-align: center;
    margin-bottom: 3rem;
    background: white;
    padding: 2.5rem 2rem;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
    border: 1px solid #f1f5f9;
}

.welcome-section h1 {
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
    letter-spacing: -1px;
}

.welcome-section p {
    font-size: 1.1rem;
    color: #64748b;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
    font-weight: 400;
}

/* Create Post Form */
.create-post {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2.5rem;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
    border: 1px solid #f1f5f9;
}

.create-post h2 {
    margin-bottom: 1.5rem;
    color: #1e293b;
    font-size: 1.5rem;
    font-weight: 700;
    text-align: center;
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #374151;
    font-size: 14px;
}

.form-control {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s ease;
    background: #f9fafb;
    font-weight: 400;
}

.form-control:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    background: white;
}

textarea.form-control {
    resize: vertical;
    min-height: 100px;
    font-family: inherit;
}

.youtube-input-group {
    position: relative;
}

.youtube-input-group::before {
    content: "‚ñ∂Ô∏è";
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 16px;
    z-index: 1;
}

.youtube-input-group .form-control {
    padding-left: 45px;
}

.youtube-preview {
    margin-top: 1rem;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    display: none;
    border: 1px solid #e5e7eb;
}

.youtube-preview iframe {
    width: 100%;
    height: 250px;
    border: none;
}

/* Posts Grid */
.posts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.post-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
    border: 1px solid #f1f5f9;
    height: fit-content;
}

.post-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    border-color: #3b82f6;
}

.post-video {
    position: relative;
    width: 100%;
    height: 200px;
    background: #000;
}

.post-video iframe {
    width: 100%;
    height: 100%;
    border: none;
}

.post-content-area {
    padding: 1.5rem;
}

.post-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 1rem;
}

.post-author-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid #3b82f6;
    object-fit: cover;
}

.post-meta {
    flex: 1;
}

.post-author {
    font-weight: 600;
    color: #1e293b;
    font-size: 14px;
}

.post-date {
    font-size: 12px;
    color: #64748b;
    margin-top: 2px;
    font-weight: 400;
}

.post-title {
    font-size: 16px;
    font-weight: 600;
    color: #1e293b;
    margin-bottom: 0.75rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.post-description {
    color: #4b5563;
    line-height: 1.5;
    font-size: 13px;
    font-weight: 400;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.post-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 1rem;
}

.tag {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

/* Loading States */
.loading {
    text-align: center;
    padding: 3rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
    border: 1px solid #f1f5f9;
}

.spinner {
    display: inline-block;
    width: 40px;
    height: 40px;
    border: 3px solid #e2e8f0;
    border-radius: 50%;
    border-top-color: #3b82f6;
    animation: spin 1s ease-in-out infinite;
    margin-bottom: 1rem;
}

.loading p {
    font-size: 14px;
    color: #64748b;
    font-weight: 500;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Hidden class */
.hidden {
    display: none !important;
}

/* Messages */
.error-message, .success-message {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-weight: 500;
    font-size: 14px;
    border: 1px solid;
}

.error-message {
    background: #fef2f2;
    color: #dc2626;
    border-color: #fecaca;
}

.success-message {
    background: #f0fdf4;
    color: #16a34a;
    border-color: #bbf7d0;
}

/* Responsive */
@media (max-width: 1024px) {
    .container {
        padding: 0 16px;
    }
    
    .posts-grid {
        gap: 1rem;
    }
}

@media (max-width: 768px) {
    body {
        font-size: 14px;
    }

    .header-content {
        flex-direction: column;
        gap: 15px;
        padding: 1rem 0;
    }

    .logo {
        font-size: 1.5rem;
    }

    .welcome-section {
        padding: 2rem 1.5rem;
        margin-bottom: 2rem;
    }

    .welcome-section h1 {
        font-size: 2rem;
    }

    .welcome-section p {
        font-size: 1rem;
    }

    .create-post {
        padding: 1.5rem;
    }

    .create-post h2 {
        font-size: 1.3rem;
    }

    .posts-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .post-video {
        height: 180px;
    }

    .post-content-area {
        padding: 1rem;
    }

    .auth-section {
        flex-direction: column;
        gap: 10px;
    }

    .user-info {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .welcome-section h1 {
        font-size: 1.8rem;
    }

    .welcome-section p {
        font-size: 14px;
    }

    .post-video {
        height: 160px;
    }
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
}
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">MiloHub</div>
                <div class="auth-section">
                    <div id="authButtons">
                        <button id="signInBtn" class="btn btn-primary">Sign in with Google</button>
                    </div>
                    <div id="userInfo" class="user-info hidden">
                        <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
                        <span id="userName"></span>
                        <button id="signOutBtn" class="btn btn-secondary">Sign Out</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="welcome-section">
                <h1>Share Educational Videos</h1>
                <p>Discover and share amazing educational YouTube videos with fellow educators. Build a collaborative learning community through video content.</p>
            </div>

            <!-- Messages -->
            <div id="messageContainer"></div>

            <!-- Create Post Form -->
            <div id="createPostSection" class="create-post hidden">
                <h2>Share an Educational Video</h2>
                <form id="createPostForm">
                    <div class="form-group">
                        <label for="postTitle">Video Title</label>
                        <input type="text" id="postTitle" class="form-control" placeholder="Enter a descriptive title for this educational video..." required>
                    </div>
                    <div class="form-group">
                        <label for="postDescription">Description & Teaching Notes</label>
                        <textarea id="postDescription" class="form-control" placeholder="Describe how this video can be used in teaching, what concepts it covers, suggested grade levels, discussion questions..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="youtubeUrl">YouTube URL</label>
                        <div class="youtube-input-group">
                            <input type="url" id="youtubeUrl" class="form-control" placeholder="https://www.youtube.com/watch?v=..." required>
                        </div>
                        <div id="youtubePreview" class="youtube-preview">
                            <iframe id="previewFrame" allowfullscreen></iframe>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="postTags">Tags (optional)</label>
                        <input type="text" id="postTags" class="form-control" placeholder="math, science, history, elementary, middle school... (comma separated)">
                    </div>
                    <button type="submit" class="btn btn-primary">Share Video</button>
                </form>
            </div>

            <!-- Posts Display -->
            <div id="postsSection">
                <div id="loadingPosts" class="loading">
                    <div class="spinner"></div>
                    <p>Loading videos...</p>
                </div>
                <div id="postsGrid" class="posts-grid hidden"></div>
            </div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>

    <script>

const firebaseConfig = {
     apiKey: "",
        authDomain: "",
        projectId: "",
        storageBucket: "",
        messagingSenderId: "",
        appId: ""//all of ur firebase credentials
};


firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();


const signInBtn = document.getElementById('signInBtn');
const signOutBtn = document.getElementById('signOutBtn');
const authButtons = document.getElementById('authButtons');
const userInfo = document.getElementById('userInfo');
const userAvatar = document.getElementById('userAvatar');
const userName = document.getElementById('userName');
const createPostSection = document.getElementById('createPostSection');
const createPostForm = document.getElementById('createPostForm');
const youtubeUrl = document.getElementById('youtubeUrl');
const youtubePreview = document.getElementById('youtubePreview');
const previewFrame = document.getElementById('previewFrame');
const loadingPosts = document.getElementById('loadingPosts');
const postsGrid = document.getElementById('postsGrid');
const messageContainer = document.getElementById('messageContainer');


let isCreateFormVisible = false;
let addVideoBtn = null;


function createAddVideoButton() {
    if (addVideoBtn) return;
    
    addVideoBtn = document.createElement('button');
    addVideoBtn.id = 'addVideoBtn';
    addVideoBtn.className = 'btn btn-primary';
    addVideoBtn.innerHTML = '+ Add Video';
    addVideoBtn.style.cssText = `
        position: fixed;
        bottom: 30px;
        right: 30px;
        z-index: 1000;
        border-radius: 50px;
        padding: 15px 25px;
        font-size: 16px;
        font-weight: 600;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        transition: all 0.3s ease;
    `;
    
    addVideoBtn.addEventListener('click', toggleCreateForm);
    addVideoBtn.addEventListener('mouseenter', () => {
        addVideoBtn.style.transform = 'translateY(-2px) scale(1.05)';
        addVideoBtn.style.boxShadow = '0 12px 35px rgba(102, 126, 234, 0.8)';
    });
    addVideoBtn.addEventListener('mouseleave', () => {
        addVideoBtn.style.transform = 'translateY(0) scale(1)';
        addVideoBtn.style.boxShadow = '0 8px 25px rgba(102, 126, 234, 0.6)';
    });
    
    document.body.appendChild(addVideoBtn);
}


function toggleCreateForm() {
    const user = auth.currentUser;
    
    if (!user) {
        showMessage('Please sign in to share videos', 'error');
        return;
    }
    
    isCreateFormVisible = !isCreateFormVisible;
    
    if (isCreateFormVisible) {
        createPostSection.classList.remove('hidden');
        addVideoBtn.innerHTML = '‚úï Cancel';
        addVideoBtn.style.backgroundColor = '#f56565';

        createPostSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    } else {
        createPostSection.classList.add('hidden');
        addVideoBtn.innerHTML = '+ Add Video';
        addVideoBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';

        createPostForm.reset();
        youtubePreview.style.display = 'none';
        youtubeUrl.style.borderColor = 'rgba(102, 126, 234, 0.2)';
        clearMessages();
    }
}


function toggleAddButton(show) {
    if (show && !addVideoBtn) {
        createAddVideoButton();
    }
    
    if (addVideoBtn) {
        addVideoBtn.style.display = show ? 'block' : 'none';
    }
}


function showMessage(message, type = 'error') {
    const messageDiv = document.createElement('div');
    messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
    messageDiv.textContent = message;
    messageContainer.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 5000);
}

function clearMessages() {
    messageContainer.innerHTML = '';
}


function extractYouTubeVideoId(url) {
    const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
        /youtube\.com\/watch\?.*v=([^&\n?#]+)/
    ];
    
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) return match[1];
    }
    return null;
}

function createEmbedUrl(videoId) {
    return `https://www.youtube.com/embed/${videoId}?rel=0&showinfo=0`;
}


youtubeUrl.addEventListener('input', (e) => {
    const url = e.target.value.trim();
    if (url) {
        const videoId = extractYouTubeVideoId(url);
        if (videoId) {
            const embedUrl = createEmbedUrl(videoId);
            previewFrame.src = embedUrl;
            youtubePreview.style.display = 'block';
            youtubeUrl.style.borderColor = '#48bb78';
        } else {
            youtubePreview.style.display = 'none';
            if (url.length > 10) {
                youtubeUrl.style.borderColor = '#f56565';
            }
        }
    } else {
        youtubePreview.style.display = 'none';
        youtubeUrl.style.borderColor = 'rgba(102, 126, 234, 0.2)';
    }
});


auth.onAuthStateChanged(user => {
    clearMessages();
    
    if (user) {

        authButtons.classList.add('hidden');
        userInfo.classList.remove('hidden');
        userAvatar.src = user.photoURL || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=45&h=45&fit=crop&crop=face';
        userName.textContent = user.displayName || 'Anonymous User';
        

        toggleAddButton(true);
        loadPosts();
        

        createPostSection.classList.add('hidden');
        isCreateFormVisible = false;
        if (addVideoBtn) {
            addVideoBtn.innerHTML = '+ Add Video';
            addVideoBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        }
    } else {

        authButtons.classList.remove('hidden');
        userInfo.classList.add('hidden');
        createPostSection.classList.add('hidden');
        postsGrid.classList.add('hidden');
        loadingPosts.classList.add('hidden');
        

        toggleAddButton(false);
        

        youtubePreview.style.display = 'none';
        isCreateFormVisible = false;
        

        postsGrid.innerHTML = `
            <div style="text-align: center; color: black; grid-column: 1/-1; padding: 3rem;">
                <h2 style="font-size: 2rem; margin-bottom: 1rem;">Welcome to MiloHub!</h2>
                <p style="font-size: 1.2rem; margin-bottom: 2rem;">Sign in with Google to share and discover educational videos</p>
                <div style="font-size: 4rem; margin-bottom: 2rem;">üéì</div>
            </div>
        `;
        postsGrid.classList.remove('hidden');
    }
});


signInBtn.addEventListener('click', async () => {
    try {
        signInBtn.textContent = 'Signing in...';
        signInBtn.disabled = true;
        
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('email');
        provider.addScope('profile');
        await auth.signInWithPopup(provider);
        showMessage('Successfully signed in!', 'success');
    } catch (error) {
        console.error('Sign in error:', error);
        if (error.code === 'auth/popup-blocked') {
            showMessage('Popup blocked. Please allow popups for this site and try again.', 'error');
        } else if (error.code === 'auth/popup-closed-by-user') {
            showMessage('Sign in cancelled.', 'error');
        } else {
            showMessage('Sign in failed. Please try again.', 'error');
        }
    } finally {
        signInBtn.textContent = 'Sign in with Google';
        signInBtn.disabled = false;
    }
});

signOutBtn.addEventListener('click', async () => {
    try {
        await auth.signOut();
        showMessage('Successfully signed out!', 'success');
    } catch (error) {
        console.error('Sign out error:', error);
        showMessage('Sign out failed. Please try again.', 'error');
    }
});

// Form submission with Firebase
createPostForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    clearMessages();
    
    const title = document.getElementById('postTitle').value.trim();
    const description = document.getElementById('postDescription').value.trim();
    const url = youtubeUrl.value.trim();
    const tags = document.getElementById('postTags').value.trim();
    
    if (!title || !description || !url) {
        showMessage('Please fill in all required fields', 'error');
        return;
    }
    
    const videoId = extractYouTubeVideoId(url);
    if (!videoId) {
        showMessage('Please enter a valid YouTube URL', 'error');
        return;
    }
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Sharing...';
    submitBtn.disabled = true;
    
    try {
        const user = auth.currentUser;
        if (!user) {
            throw new Error('User not authenticated');
        }

        // Create post data
        const postData = {
            title,
            description,
            youtubeUrl: url,
            videoId,
            tags: tags ? tags.split(',').map(tag => tag.trim()).filter(tag => tag) : [],
            authorId: user.uid,
            authorName: user.displayName || 'Anonymous User',
            authorPhoto: user.photoURL || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=45&h=45&fit=crop&crop=face',
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        // Add to Firestore
        await db.collection('videos').add(postData);
        
        // Reset form and hide it
        createPostForm.reset();
        youtubePreview.style.display = 'none';
        youtubeUrl.style.borderColor = 'rgba(102, 126, 234, 0.2)';
        
        // Hide create form
        toggleCreateForm();
        
        showMessage('Video shared successfully!', 'success');
        
        // Reload posts
        setTimeout(loadPosts, 1000);
        
    } catch (error) {
        console.error('Error creating post:', error);
        showMessage(`Failed to share video: ${error.message}`, 'error');
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
});

// Load posts from Firestore
async function loadPosts() {
    try {
        loadingPosts.classList.remove('hidden');
        postsGrid.classList.add('hidden');
        
        const snapshot = await db.collection('videos')
            .orderBy('createdAt', 'desc')
            .limit(50)
            .get();
        
        postsGrid.innerHTML = '';
        
        if (snapshot.empty) {
            postsGrid.innerHTML = `
                <div style="text-align: center; color: white; grid-column: 1/-1; padding: 3rem;">
                    <div style="font-size: 4rem; margin-bottom: 2rem;">üìö</div>
                    <h2 style="font-size: 2rem; margin-bottom: 1rem;">No videos shared yet!</h2>
                    <p style="font-size: 1.2rem; margin-bottom: 2rem;">Be the first to share an educational video with the community</p>
                    <button onclick="toggleCreateForm()" style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border: none;
                        padding: 15px 30px;
                        border-radius: 25px;
                        font-size: 16px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.6)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.4)'">
                        üé¨ Share Your First Video
                    </button>
                </div>
            `;
        } else {
            snapshot.forEach(doc => {
                const post = doc.data();
                const postElement = createPostElement(post, doc.id);
                postsGrid.appendChild(postElement);
            });
        }
        
        loadingPosts.classList.add('hidden');
        postsGrid.classList.remove('hidden');
        
    } catch (error) {
        console.error('Error loading posts:', error);
        loadingPosts.innerHTML = '<p style="color: white;">Failed to load videos. Please refresh the page.</p>';
        showMessage('Failed to load videos. Please refresh the page.', 'error');
    }
}

// Create post element
function createPostElement(post, postId) {
    const div = document.createElement('div');
    div.className = 'post-card';
    
    const embedUrl = createEmbedUrl(post.videoId);
    const createdAt = post.createdAt ? 
        post.createdAt.toDate().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        }) : 'Just now';
    
    const tagsHtml = post.tags && post.tags.length > 0 ? `
        <div class="post-tags">
            ${post.tags.map(tag => `<span class="tag">${escapeHtml(tag)}</span>`).join('')}
        </div>
    ` : '';
    
    div.innerHTML = `
        <div class="post-video">
            <iframe src="${embedUrl}" allowfullscreen loading="lazy"></iframe>
        </div>
        <div class="post-content-area">
            <div class="post-header">
                <img src="${post.authorPhoto}" alt="${post.authorName}" class="post-author-avatar" onerror="this.src='https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=45&h=45&fit=crop&crop=face'">
                <div class="post-meta">
                    <div class="post-author">${escapeHtml(post.authorName)}</div>
                    <div class="post-date">${createdAt}</div>
                </div>
            </div>
            <h3 class="post-title">${escapeHtml(post.title)}</h3>
            <div class="post-description">${escapeHtml(post.description).replace(/\n/g, '<br>')}</div>
            ${tagsHtml}
        </div>
    `;
    
    return div;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Real-time updates for posts
function setupRealtimeUpdates() {
    db.collection('videos')
        .orderBy('createdAt', 'desc')
        .limit(50)
        .onSnapshot(snapshot => {
            if (!snapshot.metadata.hasPendingWrites) {
                // Only update if it's not from local writes
                const postsContainer = document.getElementById('postsGrid');
                if (!postsContainer.classList.contains('hidden')) {
                    // Only reload if we're not currently creating a post
                    if (!isCreateFormVisible) {
                        loadPosts();
                    }
                }
            }
        }, error => {
            console.error('Error in realtime updates:', error);
        });
}

// Initialize realtime updates when user is authenticated
auth.onAuthStateChanged(user => {
    if (user) {
        setupRealtimeUpdates();
    }
});

// Handle escape key to close form
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isCreateFormVisible) {
        toggleCreateForm();
    }
});

// Make toggleCreateForm globally available
window.toggleCreateForm = toggleCreateForm;
    </script>
</body>
</html>
